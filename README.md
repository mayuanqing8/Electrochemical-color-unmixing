The matlab script published here is for the research publication: 'Electrochemical fluorescence modulation enables simultaneous multicolor imaging', by Ying Yang1, Yuanqing Ma1*, Alexander Macmillan2, Richard Tilley1, J. Justin Gooding1*.
The script provided is for academic research use only, not for commercial applications.
The main script for data analysis in each figure is indicated was Figigure number and contained 'analysis' in its file name, other scripts contained the name 'fun' are the function code called from the main analysis script.  It should be added to the matlab default function searching path for the main script to operate. 
The script was written to work with lif and CZI image files that collected from Leica Stellaris 8 Confocal and Zeiss Elyra 7 TIRF microscopes respepectively. It should be able to process images from other imaging platforms as it use bfopen functions from Bio-Format.

Briefly, the main steps of the code is the collect the Electrochemical spectra of invidvidual dyes prior to the color unmixing of dyes in the sample. this requires that the reference spectra and the sample spectra are collected under identical conditions, one of the challeng with our current setup is the operation of potentiostats and microscope was not synchronized. To ensure that the reference spectra and the experimental data are fully synchronized, we collect the reference spectra direcly from the sample data, wehere regions are exclusively occupied by one dye need to be identified. This requires transformation of the sample data to reveal different dynamis of the pixels. For instance, we use the mean, standard deviation and differentiation to transform the raw sample data into a RGB image, which is often sufficient to reveal the regions of interest.

For unmixing, EC spectra collected from a single cycle CV cycle is sufficient. For fast unmixing or to reduce photobleaching, even half of the CV cycle can be used as we demonstaeed in the 4 color STED experiment. The unmixing process use least square fitting to minimize the difference between the model and experimental spectra, where the fraction of the dyes was varied in iteration to update the model spectra. Fitting contrains was placed to ensure the fraction for each dye is non negative. The unmixing process produced multi-layered matrix with each layer contains the fraction of each dye in the given pixal location, which is used to produce the unmixed image of each channel.

Date:2025_03_06

